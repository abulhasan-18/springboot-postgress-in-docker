<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>User Registration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>

  <body
    class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-pink-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100 transition-colors duration-300"
  >
    <div class="flex items-center justify-center p-6">
      <div
        class="w-full max-w-md rounded-2xl bg-white/80 dark:bg-gray-900/70 backdrop-blur shadow-2xl ring-1 ring-black/5"
      >
        <!-- header -->
        <div class="flex items-center justify-between px-6 pt-6">
          <div>
            <h2 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
              Create an Account
            </h2>
            <p class="text-sm text-gray-500 dark:text-gray-400">
              Join and manage your users with ease
            </p>
          </div>
        </div>

        <form
          th:action="@{/register}"
          th:object="${user}"
          method="post"
          class="px-6 pb-6 pt-4 space-y-5"
        >
          <!-- CSRF (optional if Spring Security enabled) -->
          <input
            type="hidden"
            th:name="${_csrf?.parameterName}"
            th:value="${_csrf?.token}"
          />

          <!-- name -->
          <div class="relative">
            <input
              id="name"
              type="text"
              th:field="*{name}"
              required
              class="peer w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/70 dark:bg-gray-800/60 px-4 pt-5 pb-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-300 dark:focus:ring-indigo-600"
              placeholder=" "
            />
            <label
              for="name"
              class="pointer-events-none absolute left-4 top-2 text-xs font-semibold text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-3.5 peer-placeholder-shown:text-sm peer-placeholder-shown:font-normal"
            >
              Full Name
            </label>
            <p
              class="mt-1 text-xs text-rose-600"
              th:if="${#fields.hasErrors('name')}"
              th:errors="*{name}"
            >
              Invalid
            </p>
          </div>

          <!-- email -->
          <div class="relative">
            <input
              id="email"
              type="email"
              th:field="*{email}"
              required
              class="peer w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/70 dark:bg-gray-800/60 px-4 pt-5 pb-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-300 dark:focus:ring-indigo-600"
              placeholder=" "
            />
            <label
              for="email"
              class="pointer-events-none absolute left-4 top-2 text-xs font-semibold text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-3.5 peer-placeholder-shown:text-sm peer-placeholder-shown:font-normal"
            >
              Email Address
            </label>
            <p
              class="mt-1 text-xs text-rose-600"
              th:if="${#fields.hasErrors('email')}"
              th:errors="*{email}"
            >
              Invalid
            </p>
          </div>

          <!-- password -->
          <div class="space-y-2">
            <div class="relative">
              <input
                id="password"
                type="password"
                th:field="*{password}"
                required
                class="peer w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/70 dark:bg-gray-800/60 px-4 pt-5 pb-2 pr-12 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-300 dark:focus:ring-indigo-600"
                placeholder=" "
              />
              <label
                for="password"
                class="pointer-events-none absolute left-4 top-2 text-xs font-semibold text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-3.5 peer-placeholder-shown:text-sm peer-placeholder-shown:font-normal"
              >
                Password
              </label>
              <button
                type="button"
                id="togglePwd"
                class="absolute right-3 top-3 text-xs rounded-lg px-2 py-1 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-200 dark:hover:bg-gray-700"
              >
                Show
              </button>
            </div>
            <!-- strength -->
            <div
              class="h-2 w-full rounded-full bg-gray-200/70 dark:bg-gray-800/70 overflow-hidden"
            >
              <div id="pwdBar" class="h-full w-0 transition-all"></div>
            </div>
            <p id="pwdHint" class="text-xs text-gray-500 dark:text-gray-400">
              Use 8+ chars with letters, numbers & symbols.
            </p>
            <p
              class="mt-1 text-xs text-rose-600"
              th:if="${#fields.hasErrors('password')}"
              th:errors="*{password}"
            >
              Invalid
            </p>
          </div>

          <!-- submit -->
          <button
            type="submit"
            class="w-full rounded-xl bg-indigo-600 px-4 py-3 text-white font-semibold shadow hover:-translate-y-0.5 hover:bg-indigo-700 transition"
          >
            Register
          </button>

          <!-- success / info -->
          <p
            th:text="${message}"
            class="text-center text-sm font-medium text-emerald-600 dark:text-emerald-400"
          ></p>
        </form>

        <!-- footer links -->
        <div
          class="px-6 pb-6 text-center text-sm text-gray-500 dark:text-gray-400"
        >
          <a
            href="/users"
            class="underline underline-offset-4 hover:text-indigo-600 dark:hover:text-indigo-400"
            >View Users</a
          >
        </div>
      </div>
    </div>

    <script>
      // theme toggle (persist)
      const root = document.documentElement;
      const applyTheme = (m) =>
        m === "dark"
          ? root.classList.add("dark")
          : root.classList.remove("dark");
      applyTheme(localStorage.getItem("theme") || "light");
      document.getElementById("themeToggle")?.addEventListener("click", () => {
        const next =
          (localStorage.getItem("theme") || "light") === "light"
            ? "dark"
            : "light";
        localStorage.setItem("theme", next);
        applyTheme(next);
      });

      // password show/hide + strength meter
      const pwd = document.getElementById("password");
      const toggle = document.getElementById("togglePwd");
      const bar = document.getElementById("pwdBar");
      const hint = document.getElementById("pwdHint");

      toggle?.addEventListener("click", () => {
        const t = pwd.type === "password" ? "text" : "password";
        pwd.type = t;
        toggle.textContent = t === "password" ? "Show" : "Hide";
      });

      const scorePwd = (v) => {
        let s = 0;
        if (v.length >= 8) s++;
        if (/[A-Z]/.test(v)) s++;
        if (/[a-z]/.test(v)) s++;
        if (/\d/.test(v)) s++;
        if (/[^A-Za-z0-9]/.test(v)) s++;
        return Math.min(s, 4);
      };
      const setBar = (sc) => {
        const widths = ["0%", "25%", "50%", "75%", "100%"];
        const colors = [
          "transparent",
          "#fca5a5",
          "#fbbf24",
          "#60a5fa",
          "#34d399",
        ];
        bar.style.width = widths[sc];
        bar.style.backgroundColor = colors[sc];
        hint.textContent =
          ["Too short", "Weak", "Okay", "Good", "Strong"][sc] || "Strength";
      };
      pwd?.addEventListener("input", () => setBar(scorePwd(pwd.value)));
      setBar(scorePwd(pwd?.value || ""));
    </script>
  </body>
</html>
